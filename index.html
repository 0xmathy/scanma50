<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Scan MA50 v1.2 ‚Äî Screener</title>
<style>
  :root{
    --bg:#0b1016;--panel:#0f1422;--panel-2:#121a2b;--text:#e9eef5;--muted:#9aa7b8;
    --green:#28d39b;--red:#ff6b6b;--amber:#ffc857;--blue:#8bb7ff;--outline:#1c2742;
    --chip:#0d1a2a; --chip-bd:#223052;
    --radius:14px; --gap:14px;
  }
  *{box-sizing:border-box}
  body{margin:0;background:linear-gradient(180deg,#0a0f19,#0b1016);color:var(--text);font:16px/1.55 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu}
  .wrap{max-width:1200px;margin:28px auto;padding:0 16px}
  header{display:flex;justify-content:space-between;align-items:center;gap:12px;margin-bottom:6px}
  .title{font-weight:800;font-size:22px;letter-spacing:.2px}
  .toolbar{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
  .toolbar input,.btn{background:var(--panel-2);color:var(--text);border:1px solid var(--outline);border-radius:12px;padding:8px 12px}
  .btn{cursor:pointer}
  .note{color:var(--muted);font-size:12px;margin:8px 0 16px}
  #debug{display:none;margin:10px 0;padding:10px;border:1px dashed #ff6b6b;color:#ffb3b3;background:#381e1e;border-radius:12px;white-space:pre-wrap}
  #debug.show{display:block}

  .card{background:var(--panel);border:1px solid var(--outline);border-radius:var(--radius);overflow:hidden}
  .table-scroller{width:100%;overflow:auto}
  table{width:100%;border-collapse:separate;border-spacing:0; min-width:1280px;}
  thead th{position:sticky;top:0;background:linear-gradient(180deg,var(--panel),var(--panel-2));
    color:#cfe0ff;text-align:left;font-weight:700;font-size:12px;text-transform:uppercase;
    letter-spacing:.5px;border-bottom:1px solid var(--outline);padding:10px 12px}
  tbody td{padding:10px 12px;border-bottom:1px solid #0e1525; vertical-align:middle;}
  tbody tr:hover{background:rgba(255,255,255,.03)}
  .token{display:flex;align-items:center;gap:10px}
  .logo{width:22px;height:22px;border-radius:7px;background:linear-gradient(135deg,#1f2846,#2a3f6f)}
  .sym{font-weight:800}
  .muted{color:var(--muted)}
  .num{font-variant-numeric:tabular-nums; white-space:nowrap;}
  .t-good{color:var(--green)} .t-warn{color:var(--amber)} .t-bad{color:var(--red)}
  @media (max-width: 1200px){ .col-optional{ display:none; } }

  .chips{display:flex;gap:8px;flex-wrap:wrap}
  .chip{font-size:12px; padding:6px 8px; border-radius:999px;background:var(--chip); border:1px solid var(--chip-bd); color:#dbe6ff;}

  .badges{display:flex;gap:8px;flex-wrap:wrap}
  .badge{font-size:12px; line-height:1; padding:7px 10px; border-radius:10px;
    border:1px solid var(--outline); background:rgba(255,255,255,.03); color:var(--text);
    white-space:nowrap; font-weight:600;}
  .b-good{ border-color: rgba(40,211,155,.45); box-shadow: inset 0 0 0 999px rgba(40,211,155,.09);}
  .b-info{ border-color: rgba(139,183,255,.45); box-shadow: inset 0 0 0 999px rgba(139,183,255,.10);}
  .b-warn{ border-color: rgba(255,200,87,.55); box-shadow: inset 0 0 0 999px rgba(255,200,87,.12);}
  .b-bad{  border-color: rgba(255,107,107,.55); box-shadow: inset 0 6px 18px rgba(255,107,107,.14);}

  #cardsWrap{ display:block; margin-top:16px; }
  .grid{ display:grid; gap:var(--gap); grid-template-columns: repeat(2, minmax(0,1fr)); }
  @media (min-width:1200px){ .grid{ grid-template-columns: repeat(3, minmax(0,1fr)); } }
  @media (max-width:800px){ .grid{ grid-template-columns: 1fr; } }

  .sig-card{background:var(--panel); border:1px solid var(--outline); border-radius:16px;
    padding:14px; box-shadow:0 6px 18px rgba(0,0,0,.28); display:flex; flex-direction:column; gap:10px;}
  .sig-card.good { border-color: rgba(40,211,155,.5); box-shadow:0 6px 18px rgba(40,211,155,.12); }
  .sig-card.warn { border-color: rgba(255,200,87,.5);  box-shadow:0 6px 18px rgba(255,200,87,.12); }
  .sig-card.bad  { border-color: rgba(255,107,107,.5); box-shadow:0 6px 18px rgba(255,107,107,.14); }

  .sig-head{ display:flex; align-items:center; justify-content:space-between; gap:10px; }
  .sig-title{ font-weight:800; font-size:16px; letter-spacing:.2px; }
  .sig-price{ font-weight:700; }
  .sig-sub{ color:var(--muted); font-size:12px; }
  .sig-metrics{ display:flex; gap:8px; flex-wrap:wrap; }
  .sig-divider{ border:0; border-top:1px solid var(--outline); margin:8px 0; opacity:.7 }

  .actions{ display:flex; justify-content:flex-end; gap:8px; }
  .btn-ghost{ background:transparent; border:1px solid var(--outline); color:#cfe0ff; border-radius:10px; padding:6px 10px; cursor:pointer; font-size:12px; }

  /* Panneau + D√©tails */
  .details { display:none; border-top:1px solid var(--outline); padding-top:10px; }
  .details.open { display:block; }
  .kv{display:grid;grid-template-columns:auto 1fr;gap:6px 12px;font-size:14px;margin:4px 0 12px;}
  .kv .k{color:var(--muted)}
  .kv .v{font-variant-numeric:tabular-nums}
  .expl{color:var(--muted); font-size:12px; line-height:1.5; margin:-6px 0 10px 0;}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div class="title">Scan MA50 v1.2 ‚Äî Screener</div>
    <div class="toolbar">
      <input id="search" placeholder="Rechercher un token‚Ä¶" />
      <button id="btnRefresh" class="btn">‚Üª Rafra√Æchir</button>
      <label><input type="checkbox" id="autoToggle"> Auto-refresh (60s)</label>
    </div>
  </header>
  <div class="note" id="lastupdate">Chargement‚Ä¶</div>
  <div id="debug"></div>

  <div class="card"><div class="table-scroller">
    <table id="screener">
      <thead><tr>
        <th>Token</th>
        <th>Date</th>
        <th>Prix</th>
        <th>Œî24h</th>
        <th class="col-optional">Œî7j</th>
        <th class="col-optional">Œî30j</th>
        <th>Market Cap</th>
        <th>TVL</th>
        <th>MC/TVL</th>
        <th class="col-optional">Vol/MC (24h)</th>
        <th class="col-optional">Moy Vol 7j</th>
        <th class="col-optional">Moy Vol 30j</th>
        <th class="col-optional">Var Vol 7j/30j</th>
        <th>RSI D</th>
        <th class="col-optional">RSI H4</th>
        <th class="col-optional">ATH (prix)</th>
        <th>x ATH Mcap</th>
      </tr></thead>
      <tbody></tbody>
    </table>
    <div class="note" id="emptyMsg" style="display:none;padding:10px;">Aucune ligne</div>
  </div></div>

  <div id="cardsWrap"><div class="grid" id="cardsGrid"></div></div>
</div>

<script>
/* ==== Debug ==== */
const debugBox = document.getElementById('debug');
function debug(msg){ try{ debugBox.classList.add('show'); debugBox.textContent += (debugBox.textContent? '\\n':'') + msg; console.error(msg);}catch(_){} }
window.addEventListener('error', e=> debug('JS Error: '+(e.error?.message||e.message)));
window.addEventListener('unhandledrejection', e=> debug('Promise Rejection: '+(e.reason?.message||e.reason)));

/* ==== Format ==== */
const nf1 = new Intl.NumberFormat('en-US',{ maximumFractionDigits: 1 });
const nf2 = new Intl.NumberFormat('en-US',{ maximumFractionDigits: 2 });
const money = n => (n==null||isNaN(n)) ? 'N/D' : '$' + (
  Math.abs(n)>=1e12? nf2.format(n/1e12)+'T' :
  Math.abs(n)>=1e9 ? nf2.format(n/1e9)+'B' :
  Math.abs(n)>=1e6 ? nf2.format(n/1e6)+'M' :
  Math.abs(n)>=1e3 ? nf2.format(n/1e3)+'K' : nf2.format(n)
);
const fmtPct0 = n => (n==null||isNaN(n)) ? '‚Äî' : `${Math.round(+n)}%`;
const fmtPct  = n => (n==null||isNaN(n)) ? '‚Äî' : `${nf2.format(+n)}%`;
const fmtNum2 = n => (n==null||isNaN(n)) ? '‚Äî' : nf2.format(+n);

/* ==== DOM ==== */
const tbody = document.querySelector('#screener tbody');
const emptyMsg = document.getElementById('emptyMsg');
const lastupdate = document.getElementById('lastupdate');
const searchInput = document.getElementById('search');
const btnRefresh = document.getElementById('btnRefresh');
const autoToggle = document.getElementById('autoToggle');
const cardsGrid = document.getElementById('cardsGrid');

let allRows = [];
let autoTimer = null;

/* ==== Signaux & score carte ==== */
function buildSignals(t){
  const s=[];
  if(t.tvl == null) s.push({k:'TVL N/D', c:'b-bad', pri:1});
  if(t.mc_tvl != null && t.mc_tvl <= 3) s.push({k:'üíé MC/TVL‚â§3', c:'b-good', pri:3});
  if(t.mc_tvl != null && t.mc_tvl > 12) s.push({k:'MC/TVL>12', c:'b-bad', pri:2});
  if(t.var_vol_7_over_30 != null && t.var_vol_7_over_30 >= 1.5) s.push({k:'‚ö° Vol7/30‚â•1.5', c:'b-info', pri:4});
  if(t.vol_mc_24 != null && t.vol_mc_24 >= 5) s.push({k:'üíß Vol/MC‚â•5%', c:'b-good', pri:5});
  if(t.vol_mc_24 != null && t.vol_mc_24 < 1) s.push({k:'Illiquid', c:'b-warn', pri:5});
  if(t.x_ath_mc != null && t.x_ath_mc >= 3) s.push({k:'üéØ x‚â•3 ATH Mcap', c:'b-info', pri:6});
  if(t.x_ath_mc != null && t.x_ath_mc < 1) s.push({k:'Near ATH Mcap', c:'b-warn', pri:7});
  if(t.rsi_d != null && t.rsi_d <= 35) s.push({k:'üßä RSI D‚â§35', c:'b-info', pri:8});
  if(t.rsi_d != null && t.rsi_d >= 70) s.push({k:'üü• RSI D‚â•70', c:'b-bad', pri:8});
  return s.sort((a,b)=>a.pri-b.pri);
}
function cardClass(t){
  let good=0, bad=0;
  if(t.mc_tvl!=null){ if(t.mc_tvl<=3) good++; if(t.mc_tvl>12) bad++; }
  if(t.vol_mc_24!=null){ if(t.vol_mc_24>=5) good++; if(t.vol_mc_24<1) bad++; }
  if(t.rsi_d!=null){ if(t.rsi_d<=35) good++; if(t.rsi_d>=70) bad++; }
  if(bad>=1 && good===0) return 'bad';
  if(good>=2 && bad===0) return 'good';
  return 'warn';
}

/* ==== Rendu TABLE ==== */
function render(json){
  const data = Array.isArray(json?.tokens) ? json.tokens : [];
  lastupdate.textContent = 'Derni√®re M√†J : ' + (json.updated_at || '‚Äî');

  tbody.innerHTML=''; allRows.length=0;
  if(!data.length){ emptyMsg.style.display='block'; cardsGrid.innerHTML=''; return; }
  emptyMsg.style.display='none';

  data.forEach(t=>{
    const tr = document.createElement('tr');

    const price = (t.price!=null) ? '$'+nf2.format(+t.price) : '‚Äî';
    const d24 = fmtPct0(t.d24);
    const d7  = fmtPct0(t.d7);
    const d30 = fmtPct0(t.d30);
    const mc  = money(t.mc);
    const tvl = (t.tvl!=null) ? money(t.tvl) : 'N/D';
    const mctvl = (t.mc!=null && t.tvl!=null && t.tvl>0) ? nf2.format(t.mc/t.tvl) : '‚Äî';
    const volmc = (t.vol_mc_24!=null) ? nf2.format(+t.vol_mc_24)+'%' : '‚Äî';
    const vol7  = (t.vol7_avg!=null) ? money(t.vol7_avg) : '‚Äî';
    const vol30 = (t.vol30_avg!=null) ? money(t.vol30_avg) : '‚Äî';
    const var73 = (t.var_vol_7_over_30!=null) ? nf2.format(+t.var_vol_7_over_30)+'√ó' : '‚Äî';
    const rsid = (t.rsi_d!=null) ? nf2.format(+t.rsi_d) : '‚Äî';
    const rsih4= (t.rsi_h4!=null) ? nf2.format(+t.rsi_h4) : '‚Äî';
    const ath  = (t.ath!=null) ? '$'+nf2.format(+t.ath) : '‚Äî';
    const xath = (t.x_ath_mc!=null) ? 'x'+nf1.format(+t.x_ath_mc) : '‚Äî';

    tr.innerHTML = `
      <td><div class="token"><div class="logo"></div><div><span class="sym">${t.symbol||''}</span><span class="muted"> ¬∑ ${t.venue||''}</span></div></div></td>
      <td class="num">${t.alert_date || '‚Äî'}</td>
      <td class="num">${price}</td>
      <td class="num">${d24}</td>
      <td class="num col-optional">${d7}</td>
      <td class="num col-optional">${d30}</td>
      <td class="num">${mc}</td>
      <td class="num">${tvl}</td>
      <td class="num">${mctvl}</td>
      <td class="num col-optional">${volmc}</td>
      <td class="num col-optional">${vol7}</td>
      <td class="num col-optional">${vol30}</td>
      <td class="num col-optional">${var73}</td>
      <td class="num">${rsid}</td>
      <td class="num col-optional">${rsih4}</td>
      <td class="num col-optional">${ath}</td>
      <td class="num">${xath}</td>
    `;

    // couleurs
    const mctvlCell = tr.children[8];
    const mctvlVal = (t.mc!=null && t.tvl!=null && t.tvl>0) ? (t.mc/t.tvl) : NaN;
    if(!isNaN(mctvlVal)){
      if(mctvlVal <= 3) mctvlCell.classList.add('t-good');
      else if(mctvlVal <= 8) mctvlCell.classList.add('t-warn');
      else mctvlCell.classList.add('t-bad');
    }
    const volCell = tr.children[9];
    const volVal = parseFloat(t.vol_mc_24);
    if(!isNaN(volVal)){
      if(volVal >= 5) volCell.classList.add('t-good');
      else if(volVal >= 2) volCell.classList.add('t-warn');
      else volCell.classList.add('t-bad');
    }
    const rsiDCell = tr.children[13];
    const rsiDVal = parseFloat(t.rsi_d);
    if(!isNaN(rsiDVal)){
      if(rsiDVal >= 70) rsiDCell.classList.add('t-bad');
      else if(rsiDVal >= 45 && rsiDVal <= 60) rsiDCell.classList.add('t-good');
      else rsiDCell.classList.add('t-warn');
    }

    tbody.appendChild(tr);
    allRows.push(tr);
  });

  renderCards(data);
}

/* ==== Cartes ==== */
function renderCards(list){
  cardsGrid.innerHTML='';
  (list||[]).forEach((t,idx)=>{
    const sigs = buildSignals(t);
    const cls = cardClass(t);

    const div = document.createElement('div');
    div.className='sig-card '+cls;

    const price = (t.price!=null) ? '$'+nf2.format(+t.price) : '‚Äî';
    const mc  = money(t.mc);
    const tvl = (t.tvl!=null) ? money(t.tvl) : 'N/D';

    const mctvl = (t.mc_tvl!=null)? fmtNum2(t.mc_tvl) : '‚Äî';
    const rsid = (t.rsi_d!=null) ? nf2.format(+t.rsi_d) : '‚Äî';
    const xath = (t.x_ath_mc!=null) ? 'x'+nf1.format(+t.x_ath_mc) : '‚Äî';
    const volmc = (t.vol_mc_24!=null) ? fmtPct(t.vol_mc_24) : '‚Äî';
    const var73 = (t.var_vol_7_over_30!=null)? nf2.format(+t.var_vol_7_over_30)+'√ó' : '‚Äî';

    const detId = `det-${idx}-${(t.symbol||'X').toLowerCase()}`;

    div.innerHTML=`
      <div class="sig-head">
        <div>
          <div class="sig-title">${t.symbol||''}</div>
          <div class="sig-sub">${t.alert_date||'‚Äî'} ¬∑ ${t.venue||''}</div>
        </div>
        <div class="sig-price">${price}</div>
      </div>

      <div class="sig-sub">MC ${mc} ¬∑ TVL ${tvl}</div>

      <div class="sig-metrics">
        <span class="chip">MC/TVL ${mctvl}</span>
        <span class="chip">RSI D ${rsid}</span>
        <span class="chip">x ATH Mcap ${xath}</span>
        <span class="chip">Vol/MC 24h ${volmc}</span>
        <span class="chip">Vol7/30 ${var73}</span>
      </div>

      ${ (sigs.length? '<div class="badges">'+sigs.map(x=>`<span class="badge ${x.c}">${x.k}</span>`).join('')+'</div>' : '') }

      <div class="actions">
        <button class="btn-ghost" data-toggle="${detId}">+ D√©tails</button>
      </div>

      <div id="${detId}" class="details">
        <!-- Valeurs + explications -->
        <div class="kv"><div class="k">Prix</div>
          <div class="v">${price}</div></div>
        <div class="expl">Prix spot en USD (CMC).</div>

        <div class="kv"><div class="k">Œî24h / 7j / 30j</div>
          <div class="v">${fmtPct0(t.d24)} ¬∑ ${fmtPct0(t.d7)} ¬∑ ${fmtPct0(t.d30)}</div></div>
        <div class="expl">Variations CMC. Attention, fortes acc√©l√©rations r√©centes peuvent biaiser la lecture du RSI.</div>

        <div class="kv"><div class="k">Market Cap</div>
          <div class="v">${mc}</div></div>
        <div class="expl">Capitalisation courante = prix √ó supply en circulation (CMC). Utile pour comparer la taille relative des projets.</div>

        <div class="kv"><div class="k">TVL</div>
          <div class="v">${t.tvl!=null?money(t.tvl):'N/D'} <span class="muted">(${t.tvl_source||'‚Äî'})</span></div></div>
        <div class="expl">Total Value Locked (DeFiLlama). Refl√®te l‚Äôusage on-chain (collat√©raux, pools, lending‚Ä¶).</div>

        <div class="kv"><div class="k">MC/TVL</div>
          <div class="v">${t.mc_tvl!=null?fmtNum2(t.mc_tvl):'‚Äî'}</div></div>
        <div class="expl">Ratio valorisation / usage on-chain. <strong>&lt;=3</strong> souvent per√ßu comme plus ‚Äúvalue‚Äù, <strong>&gt;12</strong> = riche/tendu.</div>

        <div class="kv"><div class="k">Vol/MC (24h)</div>
          <div class="v">${t.vol_mc_24!=null?fmtPct(t.vol_mc_24):'‚Äî'}</div></div>
        <div class="expl">Liquidit√© relative. <strong>&ge;5%</strong> = bonne rotation, <strong>&lt;1%</strong> = illiquide/fragile.</div>

        <div class="kv"><div class="k">Moy Vol 7j / 30j</div>
          <div class="v">${t.vol7_avg!=null?money(t.vol7_avg):'‚Äî'} ¬∑ ${t.vol30_avg!=null?money(t.vol30_avg):'‚Äî'}</div></div>
        <div class="expl">Moyennes sur bougies daily (exchange). Indique la pression d‚Äô√©change r√©cente vs mensuelle.</div>

        <div class="kv"><div class="k">Var Vol 7j/30j</div>
          <div class="v">${t.var_vol_7_over_30!=null?nf2.format(+t.var_vol_7_over_30)+'√ó':'‚Äî'}</div></div>
        <div class="expl">Acc√©l√©ration de volume. <strong>&ge;1.5√ó</strong> = regain d‚Äôint√©r√™t/flux entrants.</div>

        <div class="kv"><div class="k">Moy Vol7j / TVL</div>
          <div class="v">${t.vol7_tvl!=null?nf2.format(+t.vol7_tvl)+'%':'‚Äî'}</div></div>
        <div class="expl">Montre la part d‚Äô√©changes r√©cents par rapport aux fonds ‚Äúbloqu√©s‚Äù. Utile pour jauger de l‚Äôactivit√© sp√©culative.</div>

        <div class="kv"><div class="k">RSI Daily / H4</div>
          <div class="v">${t.rsi_d!=null?nf2.format(+t.rsi_d):'‚Äî'} ¬∑ ${t.rsi_h4!=null?nf2.format(+t.rsi_h4):'‚Äî'}</div></div>
        <div class="expl">RSI(14). <strong>&gt;70</strong> = surachat (risque de pullback), <strong>&lt;35</strong> = survente (potentiel rebond). Le H4 donne le rythme court terme.</div>

        <div class="kv"><div class="k">ATH (prix)</div>
          <div class="v">${t.ath!=null?('$'+nf2.format(+t.ath)):'‚Äî'} ${t.ath_date?('¬∑ '+t.ath_date):''}</div></div>
        <div class="expl">Plus haut historique (sur l‚Äôhorizon r√©cup√©r√© via klines). √Ä compl√©ter si besoin avec plus d‚Äôhistorique.</div>

        <div class="kv"><div class="k">ATH Mcap</div>
          <div class="v">${t.ath_mc!=null?money(t.ath_mc):'‚Äî'}</div></div>
        <div class="expl">Capitalisation implicite au prix ATH (supply circ. si disponible, sinon proportion vs MC actuelle).</div>

        <div class="kv"><div class="k">x ATH Mcap</div>
          <div class="v">${t.x_ath_mc!=null?('x'+nf1.format(+t.x_ath_mc)):'‚Äî'}</div></div>
        <div class="expl">Multiplicateur pour revenir √† la market cap ATH. Utile pour estimer le ‚Äúpotentiel‚Äù relatif.</div>

        <div class="kv"><div class="k">Prix cible (ATH Mcap)</div>
          <div class="v">${t.price_target_ath_mc!=null?('$'+nf2.format(+t.price_target_ath_mc)):'‚Äî'}</div></div>
        <div class="expl">Prix th√©orique si la capi revenait √† son ATH avec la supply actuelle (approx.).</div>

        <div class="kv"><div class="k">Rank / FDV / Supplies</div>
          <div class="v">
            rank: ${t.rank!=null?String(t.rank):'‚Äî'} ¬∑ FDV: ${t.fdv!=null?money(t.fdv):'‚Äî'} ¬∑
            circ: ${t.circulating_supply!=null?nf2.format(+t.circulating_supply):'‚Äî'} ¬∑
            total: ${t.total_supply!=null?nf2.format(+t.total_supply):'‚Äî'} ¬∑
            max: ${t.max_supply!=null?nf2.format(+t.max_supply):'‚Äî'}
          </div></div>
        <div class="expl">FDV = Fully Diluted Valuation. Attention aux gros unlocks (si connus) qui augmentent la supply en circulation.</div>
      </div>
    `;

    // Toggle details
    div.querySelector(`[data-toggle="${detId}"]`).addEventListener('click', (ev)=>{
      const panel = div.querySelector('#'+detId);
      const open = panel.classList.toggle('open');
      ev.currentTarget.textContent = open ? '‚Äî Masquer' : '+ D√©tails';
    });

    cardsGrid.appendChild(div);
  });
}

/* ==== Charger data.json ==== */
async function loadData(){
  try{
    const res = await fetch('data.json?ts='+Date.now(), { cache:'no-store' });
    if(!res.ok){ debug(`HTTP ${res.status} ${res.statusText} sur data.json`); render({ tokens: [] }); lastupdate.textContent = 'Erreur: data.json introuvable'; return; }
    const json = await res.json();
    if(!json || !Array.isArray(json.tokens)){ debug('Format data.json inattendu'); render({ tokens: [] }); lastupdate.textContent='Erreur: format data.json'; return; }
    render(json);
  }catch(e){
    debug('loadData() failed: '+(e.message||e));
    render({ tokens: [] });
    lastupdate.textContent = 'Erreur de chargement';
  }
}

/* ==== Search / Refresh / Auto ==== */
document.getElementById('search').addEventListener('input', (e)=>{
  const q = e.target.value.trim().toLowerCase();
  document.querySelectorAll('#screener tbody tr').forEach(r=>{
    r.style.display = r.innerText.toLowerCase().includes(q) ? '' : 'none';
  });
});
document.getElementById('btnRefresh').addEventListener('click', loadData);

function startAuto(){ stopAuto(); autoTimer=setInterval(loadData, 60_000); }
function stopAuto(){ if(autoTimer){ clearInterval(autoTimer); autoTimer=null; } }
autoToggle.checked = localStorage.getItem('autoRefresh')==='1';
if(autoToggle.checked) startAuto();
autoToggle.addEventListener('change', ()=>{
  if(autoToggle.checked){ startAuto(); localStorage.setItem('autoRefresh','1'); }
  else { stopAuto(); localStorage.setItem('autoRefresh','0'); }
});

/* ==== Boot ==== */
document.addEventListener('DOMContentLoaded', loadData);
</script>
</body>
</html>
