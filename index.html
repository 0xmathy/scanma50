<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>👑 Rois du Bitcoin — Screener</title>
<style>
  :root{
    /* Palette “noir + or” */
    --bg:#0a0d13;
    --bg-soft:#0d1119;
    --panel:#0b1018;
    --card:#0c121c;
    --ink:#e7ecf7;
    --muted:#93a0b8;

    --gold:#f4c542;              /* accent principal */
    --gold-2:#ffd76b;            /* hover / lueur */
    --royal:#2a55ff;             /* accent secondaire discret */
    --good:#12d18e;
    --bad:#f1475a;
    --warn:#f59e0b;

    --border:#182034;
    --chip:#0b1426;
    --shadow:0 12px 40px rgba(0,0,0,.45);
  }
  *{box-sizing:border-box}
  body{
    margin:0; color:var(--ink);
    font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial;
    background:
      radial-gradient(1000px 600px at 12% -10%, rgba(244,197,66,.08), transparent 55%),
      radial-gradient(900px 500px at 85% -15%, rgba(42,85,255,.08), transparent 55%),
      linear-gradient(180deg,#070b11 0%, #060910 100%) fixed;
  }

  /* Header */
  header{
    position:sticky; top:0; z-index:20;
    background:linear-gradient(90deg, rgba(10,13,19,.9), rgba(13,17,25,.75));
    border-bottom:1px solid var(--border);
    backdrop-filter:saturate(1.2) blur(10px);
  }
  .hdr{
    max-width:1200px; margin:auto; padding:14px 16px;
    display:flex; align-items:center; gap:12px;
  }
  .brand{
    display:flex; align-items:center; gap:10px; font-weight:800; letter-spacing:.2px;
  }
  .crown{
    width:28px; height:28px; border-radius:8px;
    display:grid; place-items:center;
    background: radial-gradient(60% 60% at 30% 25%, var(--gold), transparent 60%),
                linear-gradient(135deg, rgba(244,197,66,.25), rgba(42,85,255,.18));
    border:1px solid rgba(244,197,66,.35);
    box-shadow: inset 0 0 0 2px rgba(255,255,255,.04);
  }
  .muted{ color:var(--muted) }
  .pill{
    display:inline-flex; align-items:center; gap:8px;
    padding:6px 10px; border:1px solid var(--border); border-radius:999px;
    background:rgba(244,197,66,.08); color:#ffe9aa; font-size:12px;
  }

  /* Layout */
  .wrap{
    max-width:1200px; margin:22px auto; padding:0 16px;
    display:grid; grid-template-columns: 1fr minmax(360px, 0); gap:16px;
  }
  @media (max-width:980px){ .wrap{ grid-template-columns:1fr } }

  /* Table */
  .tableWrap{
    background:var(--bg-soft); border:1px solid var(--border); border-radius:16px;
    box-shadow:var(--shadow); overflow:auto;
  }
  table{ width:100%; border-collapse:separate; border-spacing:0; min-width:960px; }
  thead th{
    position:sticky; top:0;
    background:linear-gradient(180deg,#0f1522 0%, #0b111b 100%);
    border-bottom:1px solid var(--border);
    font-weight:700; font-size:12px; text-align:left; padding:10px 12px; color:#d7e1f7;
  }
  tbody td{
    padding:12px; border-bottom:1px solid #0e172a; font-size:13px; vertical-align:middle;
  }
  tbody tr{ transition: background .15s ease, transform .05s ease }
  tbody tr:hover{
    background:linear-gradient(90deg, rgba(244,197,66,.05), transparent 35%);
  }

  .tag{ font-size:11px; padding:2px 8px; border-radius:999px; border:1px solid var(--border);
        background:linear-gradient(180deg,#0a1324,#09101b); color:#dbe6ff }
  .num{ font-variant-numeric: tabular-nums }
  .pos{ color:var(--good) } .neg{ color:var(--bad) }

  .chip{ display:inline-flex; align-items:center; gap:6px; padding:4px 8px; border-radius:10px;
         background:var(--chip); border:1px solid var(--border); font-size:12px; }
  .chip.good{ border-color:rgba(18,209,142,.35); background:rgba(18,209,142,.08) }
  .chip.warn{ border-color:rgba(245,158,11,.35); background:rgba(245,158,11,.08) }
  .chip.bad{  border-color:rgba(241,71,90,.35);  background:rgba(241,71,90,.08) }

  /* Panel */
  .panel{
    position:relative; background:var(--panel); border:1px solid var(--border); border-radius:16px;
    box-shadow:var(--shadow); min-height:360px; display:none; flex-direction:column; overflow:hidden;
  }
  .panel.open{ display:flex }
  .panelHead{
    display:flex; align-items:center; justify-content:space-between; gap:10px;
    padding:12px; border-bottom:1px solid var(--border);
    background:linear-gradient(90deg,#0f1627,#0f1b33);
  }
  .title{ display:flex; align-items:center; gap:12px; min-width:0 }
  .avatar{
    width:40px; height:40px; border-radius:10px; display:grid; place-items:center; font-weight:900;
    background: radial-gradient(60% 60% at 30% 25%, var(--gold), transparent 60%),
                linear-gradient(135deg, rgba(244,197,66,.25), rgba(42,85,255,.15));
    color:#0c1018; border:1px solid rgba(244,197,66,.35);
    box-shadow: inset 0 0 0 2px rgba(255,255,255,.04);
  }
  .sigToini{
    display:inline-flex; align-items:center; gap:6px; padding:4px 8px; border-radius:999px;
    background:rgba(244,197,66,.12); border:1px solid rgba(244,197,66,.35);
    color:#ffe9aa; font-size:11px; font-weight:700; letter-spacing:.2px;
  }

  .panelBody{ padding:12px; overflow-y:auto; overflow-x:hidden; }
  .kpiRow{ display:grid; grid-template-columns: repeat(4, minmax(150px,1fr)); gap:10px; }
  @media (max-width:980px){ .kpiRow{ grid-template-columns: repeat(2, minmax(150px,1fr)); } }
  .kpi{
    background:var(--card); border:1px solid var(--border); border-radius:12px; padding:12px;
    display:flex; flex-direction:column; gap:6px;
  }
  .kpi .label{ font-size:11px; color:var(--muted); display:flex; align-items:center; gap:6px }
  .kpi .value{ font-size:16px; font-weight:800 }
  .kpi .sub{ font-size:12px; color:var(--muted) }

  .row{ display:flex; gap:12px; flex-wrap:wrap; }
  .card{ background:var(--card); border:1px solid var(--border); border-radius:12px; padding:12px; flex:1 1 230px; min-width:230px; }
  .card h4{ margin:0 0 8px 0; font-size:12px; color:#f0f4ff; letter-spacing:.2px }
  .bar{ height:8px; background:#0b1328; border:1px solid var(--border); border-radius:999px; overflow:hidden }
  .bar>i{ display:block; height:100%; background:linear-gradient(90deg,var(--gold), var(--royal)); width:0% }
  .pillLarge{
    display:flex; align-items:center; justify-content:center; gap:8px; padding:8px 10px;
    border-radius:10px; border:1px solid var(--border);
    background:linear-gradient(180deg,#101731,#0c1226); font-weight:800; font-size:14px;
  }

  .rsiChips{ display:flex; gap:8px; flex-wrap:wrap }
  .rsiChip{ padding:4px 8px; border-radius:10px; border:1px solid var(--border); background:#0f1730; font-size:12px }

  .badge{ font-size:11px; padding:6px 8px; border-radius:999px; background:#0f1830; border:1px solid var(--border) }

  .links{ display:flex; gap:8px; flex-wrap:wrap }
  .iconBtn{
    display:inline-flex; align-items:center; gap:8px; padding:8px 10px; border-radius:10px;
    background:#0f1730; border:1px solid var(--border); color:#e9f1ff; text-decoration:none; font-size:12px;
  }
  .iconBtn .ic{ width:16px; height:16px; display:inline-grid; place-items:center }
  .iconBtn:hover{ border-color: rgba(244,197,66,.5); box-shadow:0 0 0 3px rgba(244,197,66,.1) }

  .handle{ position:absolute; top:0; left:-6px; width:12px; height:100%; cursor:col-resize; background: linear-gradient(90deg, transparent 0%, rgba(255,255,255,.06) 50%, transparent 100%); }
  .tools{ display:flex; align-items:center; gap:8px}
  .btn{ background:#101833; border:1px solid var(--border); color:#cfe0ff; padding:6px 10px; border-radius:10px; cursor:pointer }
  .btn.active{ background:#183058 }
  .tip{ border-bottom:1px dotted rgba(244,197,66,.6); cursor:help; color:#ffe9aa }

  .status{ padding:4px 8px; border-radius:999px; border:1px solid var(--border); background:#0b1326; font-size:11px }
  .status.today{ background: rgba(42,85,255,.12); border-color: rgba(42,85,255,.35); color:#cfe0ff }
  .status.yesterday{ background: rgba(18,209,142,.12); border-color: rgba(18,209,142,.35); color:#b9f4d5 }

  .nowrap{ white-space:nowrap } .truncate{ white-space:nowrap; overflow:hidden; text-overflow:ellipsis; max-width:100% } .small{ font-size:12px }
</style>
</head>
<body>
<header>
  <div class="hdr">
    <div class="crown">👑</div>
    <div class="brand">Rois du Bitcoin</div>
    <span id="lastUpdate" class="muted small">—</span>
    <span class="pill">Alerte MA50</span>
  </div>
</header>

<div class="wrap" id="layout">
  <div class="tableWrap">
    <table id="tbl">
      <thead>
        <tr>
          <th>Date</th>
          <th>Symbole</th>
          <th>Prix</th>
          <th>24h</th>
          <th>MC</th>
          <th>TVL</th>
          <th>MC/TVL</th>
          <th>x ATH Mcap</th>
          <th>Flux 24h</th>
        </tr>
      </thead>
      <tbody id="tbody"></tbody>
    </table>
  </div>

  <aside class="panel" id="panel">
    <div class="handle" id="handle" title="Redimensionner"></div>
    <div class="panelHead">
      <div class="title">
        <div class="avatar" id="avatar">—</div>
        <div>
          <div id="tName" class="truncate" style="font-weight:900;"></div>
          <div class="muted small" id="tMeta"></div>
        </div>
      </div>
      <div class="tools">
        <span class="sigToini">MA50 Buy</span>
        <span id="alertTag" class="status">—</span>
        <button class="btn" id="pinBtn" title="Épingler">📌</button>
        <button class="btn" id="closeBtn" title="Fermer">✕</button>
      </div>
    </div>
    <div class="panelBody">
      <!-- KPIs coeur -->
      <div class="kpiRow" id="kpis"></div>

      <!-- Flux & xATH -->
      <div class="row" style="margin:12px 0">
        <div class="card">
          <h4>Vol 24h / Mcap</h4>
          <div class="bar"><i id="volmc_bar" style="width:0%"></i></div>
          <div id="volmc_txt" class="small muted" style="margin-top:6px">—</div>
        </div>
        <div class="card">
          <h4>Moy Vol 7j / TVL</h4>
          <div class="bar"><i id="vol7tvl_bar" style="width:0%"></i></div>
          <div id="vol7tvl_txt" class="small muted" style="margin-top:6px">—</div>
        </div>
        <div class="card">
          <h4>Var Vol 7j / 30j</h4>
          <div id="var73_pill" class="pillLarge">—</div>
        </div>
        <div class="card">
          <h4>Potentiel (x ATH Mcap)</h4>
          <div id="athx_pill" class="pillLarge">—</div>
          <div id="ath_sub" class="small muted" style="margin-top:6px">ATH prix —</div>
        </div>
      </div>

      <!-- Contexte & liens -->
      <div class="row">
        <div class="card" style="flex:2">
          <h4>Résumé</h4>
          <div id="blurb" class="small muted">—</div>
          <div class="meta" id="metaTags" style="margin-top:10px"></div>
        </div>
        <div class="card" style="flex:1">
          <h4>Liens</h4>
          <div class="links" id="links"></div>
        </div>
      </div>
    </div>
  </aside>
</div>

<script>
/* ---------- Format helpers ---------- */
const fmt = {
  num:(n, d=2)=> (n==null || !isFinite(n)) ? '—' : Number(n).toLocaleString('fr-FR',{maximumFractionDigits:d}),
  kmb:(n)=>{
    if(n==null || !isFinite(n)) return '—';
    const abs = Math.abs(n);
    if(abs>=1e12) return (n/1e12).toFixed(2)+'T';
    if(abs>=1e9)  return (n/1e9 ).toFixed(2)+'B';
    if(abs>=1e6)  return (n/1e6 ).toFixed(2)+'M';
    if(abs>=1e3)  return (n/1e3 ).toFixed(2)+'k';
    return String(n.toFixed(2));
  },
  pct:(n, d=2)=> (n==null || !isFinite(n)) ? '—' : ((n>=0?'+':'') + n.toFixed(d) + '%'),
  dateFR:(iso)=> { if(!iso) return '—'; const dt = new Date(iso); return dt.toLocaleDateString('fr-FR', { timeZone: 'Europe/Paris' }); }
};
function setLastUpdate(ts){
  const el=document.getElementById('lastUpdate');
  if(!ts){ el.textContent='—'; return; }
  const d=new Date(ts);
  el.textContent='MàJ : '+d.toLocaleString('fr-FR',{timeZone:'Europe/Paris'});
}

/* ---------- Color helpers ---------- */
const colors = {
  mcTvl:(x)=>{
    if(x==null || !isFinite(x)) return 'chip';
    if(x<=1.5) return 'chip good';
    if(x<=5)   return 'chip warn';
    return 'chip bad';
  },
  posNeg:(n)=> n==null? '' : (n>=0?'pos':'neg'),
};

/* ---------- Table row ---------- */
function rowHTML(t){
  const dclass = colors.posNeg(t.d24);
  const mc_tvl = (t.mc_tvl!=null && isFinite(t.mc_tvl)) ? t.mc_tvl : null;
  const mcTvlClass = colors.mcTvl(mc_tvl);
  const volmc = t.vol_mc_24!=null ? t.vol_mc_24 : null;
  const xath = t.x_ath_mc!=null ? 'x'+Number(t.x_ath_mc).toFixed(2) : '—';

  return `<tr data-sym="${t.symbol}">
    <td class="num">${fmt.dateFR(t.alert_date)}</td>
    <td class="nowrap"><span class="tag">${t.symbol}</span></td>
    <td class="num">${fmt.num(t.price,6)}</td>
    <td class="num ${dclass}">${fmt.pct(t.d24)}</td>
    <td class="num">${fmt.kmb(t.mc)}</td>
    <td class="num">${fmt.kmb(t.tvl)}</td>
    <td><span class="${mcTvlClass}">${mc_tvl!=null? mc_tvl.toFixed(2) : '—'}</span></td>
    <td class="num">${xath}</td>
    <td class="num">${volmc!=null? volmc.toFixed(2)+'%' : '—'}</td>
  </tr>`;
}
function mountTable(list){ document.getElementById('tbody').innerHTML = list.map(rowHTML).join(''); }

/* ---------- Panel fill ---------- */
function ensurePanelOpen(open=true){ const p=document.getElementById('panel'); if(open) p.classList.add('open'); else p.classList.remove('open'); }
function setAvatar(sym){ document.getElementById('avatar').textContent=(sym||'—').slice(0,4).toUpperCase(); }
function setMeta(t){
  const m=document.getElementById('tMeta');
  const parts=[]; if(t.source) parts.push(`src: ${t.source}`); if(t.venue) parts.push(`• ${t.venue}`); if(t.asset_pair) parts.push(`• ${t.asset_pair}`);
  m.textContent=parts.join(' ');
}
function kpi(label,val,sub=''){
  return `<div class="kpi">
    <div class="label">${label}</div>
    <div class="value">${val}</div>
    ${sub? `<div class="sub">${sub}</div>`:''}
  </div>`;
}
function buildKpis(t){
  const d24class=colors.posNeg(t.d24);
  const mcT=colors.mcTvl(t.mc_tvl);
  const chips=[
    kpi(`Prix`, `<span class="num">${fmt.num(t.price,6)}</span>`, `<span class="${d24class}">${fmt.pct(t.d24)}</span>`),
    kpi(`Market Cap`, `<span class="num">${fmt.kmb(t.mc)}</span>`, t.rank? `Rang #${t.rank}`:''),
    kpi(`TVL`, `<span class="num">${fmt.kmb(t.tvl)}</span>`, t.tvl_source? `<span class="small muted">${t.tvl_source}</span>`:''),
    kpi(`MC / TVL`, `<span class="${mcT}">${t.mc_tvl!=null? t.mc_tvl.toFixed(2) : '—'}</span>`)
  ];
  document.getElementById('kpis').innerHTML=chips.join('');
}
function setBars(t){
  const volmc=document.getElementById('volmc_bar'); const volmcTxt=document.getElementById('volmc_txt');
  const v=(t.vol_mc_24!=null && isFinite(t.vol_mc_24))? Math.max(0,Math.min(100,t.vol_mc_24)) : null;
  volmc.style.width= v!=null ? Math.min(v,100)+'%' : '0%';
  volmcTxt.textContent= (t.vol_mc_24!=null) ? `${t.vol_mc_24.toFixed(2)} %` : '—';

  const b2=document.getElementById('vol7tvl_bar'); const t2=document.getElementById('vol7tvl_txt');
  const r=(t.vol7_tvl!=null && isFinite(t.vol7_tvl))? Math.max(0,Math.min(200,t.vol7_tvl)) : null;
  b2.style.width= r!=null ? Math.min(r,100)+'%' : '0%';
  t2.textContent= (t.vol7_tvl!=null) ? `${t.vol7_tvl.toFixed(2)} %` : '—';

  const pill=document.getElementById('var73_pill');
  if(t.var_vol_7_over_30==null || !isFinite(t.var_vol_7_over_30)){
    pill.textContent='—'; pill.style.background='linear-gradient(180deg,#101731,#0c1226)';
  }else{
    const x=t.var_vol_7_over_30;
    pill.textContent=(x>1?'↑ ':(x<1?'↓ ':''))+x.toFixed(2);
    pill.style.background=(x>1.4)? 'linear-gradient(90deg,#12d18e,#f4c542)'
                     : (x<0.8)? 'linear-gradient(90deg,#64748b,#334155)'
                              : 'linear-gradient(180deg,#101731,#0c1226)';
  }
}
function setATH(t){
  const pill=document.getElementById('athx_pill'); const sub=document.getElementById('ath_sub');
  pill.textContent= (t.x_ath_mc!=null && isFinite(t.x_ath_mc)) ? ('× '+t.x_ath_mc.toFixed(2)):'—';
  const athTxt=(t.ath!=null && isFinite(t.ath)) ? (t.ath.toFixed(6)+' $'):'—';
  const dateTxt=t.ath_date ? new Date(t.ath_date).toLocaleDateString('fr-FR'):'—';
  sub.textContent=`ATH prix ${athTxt} (${dateTxt})`;
}
function buildMetaTags(t){
  const arr=[]; if(t.sector) arr.push(`<span class="badge">${t.sector}</span>`);
  (t.tags||[]).slice(0,3).forEach(x=> arr.push(`<span class="badge">${x}</span>`));
  if((t.llama_chains||[]).length){ arr.push(`<span class="badge">Chains: ${(t.llama_chains||[]).slice(0,4).join(', ')}</span>`); }
  document.getElementById('metaTags').innerHTML = arr.join('') || `<span class="small muted">Aucun tag</span>`;
}
function setLinks(t){
  const el=document.getElementById('links');
  const L=[];
  if(t.website)    L.push(`<a class="iconBtn" href="${t.website}" target="_blank" rel="noopener"><span class="ic">🌐</span>Site</a>`);
  if(t.twitter)    L.push(`<a class="iconBtn" href="${t.twitter}" target="_blank" rel="noopener"><span class="ic">𝕏</span>Twitter</a>`);
  if(t.whitepaper) L.push(`<a class="iconBtn" href="${t.whitepaper}" target="_blank" rel="noopener"><span class="ic">📄</span>Whitepaper</a>`);
  if(t.slug)       L.push(`<a class="iconBtn" href="https://coinmarketcap.com/currencies/${t.slug}/" target="_blank" rel="noopener"><span class="ic">📊</span>CMC</a>`);
  if(t.tvl_source && t.tvl_source.startsWith('protocol:')){
    const slug=t.tvl_source.split(':')[1];
    L.push(`<a class="iconBtn" href="https://defillama.com/protocol/${slug}" target="_blank" rel="noopener"><span class="ic">🦙</span>DeFiLlama</a>`);
  }
  el.innerHTML = L.join('') || `<span class="small muted">Aucun lien</span>`;
}
function openDetails(t){
  ensurePanelOpen(true);
  document.getElementById('tName').textContent=(t.name||t.symbol||'—')+(t.symbol?` (${t.symbol})`:'');
  setAvatar(t.symbol);
  setMeta(t);
  document.getElementById('alertTag').textContent = t.alert_date ? new Date(t.alert_date).toLocaleDateString('fr-FR') : '—';

  buildKpis(t);
  setBars(t);
  setATH(t);

  const blurb = t.blurb || (t.sector || t.protocol_name || (t.llama_chains||[]).length
                ? `${t.sector? 'Secteur: '+t.sector+'. ':''}${t.protocol_name? 'Protocole: '+t.protocol_name+'. ':''}${(t.llama_chains||[]).length? 'Chains: '+t.llama_chains.slice(0,3).join(', ')+'.':''}`
                : 'Pas de descriptif.');
  document.getElementById('blurb').textContent=blurb;
  buildMetaTags(t);
  setLinks(t);
}

/* ---------- Interactions ---------- */
function bindRowClicks(list){
  Array.from(document.querySelectorAll('#tbody tr')).forEach(tr=>{
    tr.addEventListener('click', ()=>{
      const sym = tr.getAttribute('data-sym') || tr.querySelector('.tag')?.textContent?.trim();
      const t = list.find(x=>x.symbol===sym);
      if(t) openDetails(t);
    });
  });
}
(function setupPanel(){
  const pinBtn=document.getElementById('pinBtn'); const closeBtn=document.getElementById('closeBtn');
  let pinned=false;
  pinBtn.addEventListener('click',()=>{ pinned=!pinned; pinBtn.classList.toggle('active', pinned); });
  closeBtn.addEventListener('click',()=> ensurePanelOpen(false));
  // Resize
  const handle=document.getElementById('handle'); let drag=false;
  handle.addEventListener('mousedown',(e)=>{ drag=true; document.body.style.userSelect='none'; e.preventDefault(); });
  window.addEventListener('mousemove',(e)=>{
    if(!drag) return;
    const wrap=document.getElementById('layout'); const rect=wrap.getBoundingClientRect();
    const rightW=Math.min(Math.max(360, rect.right - e.clientX), 640);
    wrap.style.gridTemplateColumns = `1fr ${rightW}px`;
  });
  window.addEventListener('mouseup',()=>{ drag=false; document.body.style.userSelect='auto'; });
})();

/* ---------- Boot ---------- */
async function main(){
  const res = await fetch('data.json', {cache:'no-cache'});
  const data = await res.json();
  setLastUpdate(data.updated_at);

  const list = Array.isArray(data.tokens)? data.tokens : [];
  document.getElementById('tbody').innerHTML = list.map(t=> `<tr data-sym="${t.symbol}">${rowHTML(t).replace(/^<tr[^>]*>|<\/tr>$/g,'')}</tr>`).join('');
  bindRowClicks(list);
  if(list.length) openDetails(list[0]);
}
main();
</script>
</body>
</html>
